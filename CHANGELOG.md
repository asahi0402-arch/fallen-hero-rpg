# CHANGELOG - 堕ちた英雄RPG

## Version 0.9.2 - ストーリーシステム大幅改善 + ユーザビリティ向上 (2025-08-27)

### 🎮 新機能
- **タイトル画面の完全実装**
  - `title.html`、`title.css`、`title.js`による美しいタイトル画面
  - ゲームスタート、ロード、ギャラリー（準備中）、オプション機能
  - CSVベース（`title_settings.csv`）でのタイトル画像管理システム
  - 動的キャラクター立ち絵表示機能

- **セーブ・ロードシステム完全実装**
  - LocalStorageベースの包括的セーブシステム
  - プレイヤーデータ、共有データ、戦闘進行状況の完全保存
  - タイトル画面からのロード機能
  - セーブデータ詳細情報表示（キャラクター、レベル、章、日時）

- **ギルドベーストーリーシステム**
  - 章開始時の強制ストーリーを廃止
  - ギルド初回訪問時にストーリーイベントが発生する新システム
  - 章ごとのギルド訪問履歴管理（`guildFirstVisits`）
  - プレイヤーの任意タイミングでストーリー体験可能

### 🛠️ バグ修正・安定性向上
- **ストーリーイベント関連の重大な修正**
  - `storyInProgress`フラグが永続化する問題を完全解決
  - ポップアップブロック時の自動フラグリセット機能
  - 30秒タイムアウト機能でストーリー終了後の動作保証
  - デバッグ用`resetStoryFlag()`関数の追加

- **移動制限システムの改善**
  - ダンジョン→フィールド直接移動を禁止（帰還の玉必須）
  - ダンジョンボス撃破後の自動街帰還機能
  - ストーリーイベント中の移動制限（移動ボタン無効化）

- **ゲーム風モーダル統合**
  - ブラウザ標準のalert/confirmを全廃
  - 美しいゲーム内テーマのカスタム確認モーダル実装
  - タイトル復帰、ロード確認での一貫したUI体験

### 🎨 UI/UX大幅改善
- **オプションシステムの拡張**
  - BGM・SE音量調整スライダー
  - メッセージ速度設定（遅い・普通・速い・瞬間）
  - タイトルへ戻る機能
  - ゲーム内・タイトル画面両方からアクセス可能

- **武器種別制限システム**
  - キャラクタークラス別武器制限実装（戦士=剣、武闘家=拳、弓使い=弓、魔法使い=杖）
  - 4武器種×4章＋ガチャ品の包括的武器系統実装
  - 制限違反時のエラーメッセージ表示
  - プレイヤーステータス表示の動的キャラクター名化

### 🔧 技術改善
- **データ管理の強化**
  - `title_settings.csv`による設定ファイル外部化
  - ギルド訪問履歴のセーブ・ロード対応
  - キャラクタークラス（`character_class`）フィールド全体統合
  - 武器種別（`weapon_type`）フィールド装備システム統合

- **ストーリー管理アーキテクチャの改善**
  - `story_trigger.js`の`triggerStory()`にウィンドウ監視機能追加
  - フォールバックタイマー機能で確実なリソース解放
  - 非ブロッキングストーリーシステム（ゲーム操作継続可能）

### 📊 現在の状態
- ✅ 完全なタイトル画面システム
- ✅ セーブ・ロードシステム完全動作
- ✅ ギルドベーストーリーシステム
- ✅ 武器種別制限システム完全実装
- ✅ ストーリーイベント干渉問題完全解決
- ✅ 移動制限・自動帰還システム
- ✅ ゲーム風UI統一（モーダル・確認画面）
- ✅ オプション設定システム完全動作

---

## Version 0.9.1 - アイテム・装備システム完全統合 (2025-01-26)

### 🛠️ バグ修正
- **アイテムシステム統合**
  - `shop.csv` + `items.csv` → `items_unified.csv`に統合
  - `equipment_unified.csv`のフィールド名統一（`item_id` → `id`, `item_name` → `name`, `price` → `buy_price`）
  - ショップでの装備品表示問題を解決

- **装備システム修正**
  - JavaScript側の`item_id`参照を`id`に統一
  - `equipment_type`フィールドによる装備判定を追加
  - `startsWith`エラーの修正（`itemInfo.effect_type?.startsWith()`）
  - 装備品の処理フローを完全統合

### 🔧 技術改善
- **データ整合性向上**
  - CSVフィールド名の完全統一
  - データアクセス関数の一元化（`getAvailableShopItems()`, `getShopItem()`）
  - ID不一致によるundefinedエラーを完全排除

### 📊 現在の状態
- ✅ オートモード完全動作
- ✅ SE・エフェクト統合システム
- ✅ レベルアップ自動/手動選択
- ✅ 戦闘フロー自動化
- ✅ アイテム・装備システム完全統合

---

## Version 0.9.0 - オートモード機能実装 + SEシステム統一 (2025-01-26)

### 🎮 新機能
- **オートモード機能**完全実装
  - レベルアップ時の選択肢：「戦闘中断」または「自動割り振り」
  - オートモード設定モーダル追加
  - 戦闘フロー自動化（攻撃→敵ターン→次の戦闘）
  
### 🛠️ バグ修正
- **オートモード関連**
  - プレイヤー死亡判定を修正（`handlePlayerDefeat()`の呼び出し追加）
  - オートモード解除機能修正（手動ボタンが機能するように）
  - レベルアップ画面表示時の戦闘中断機能実装
  - オート時のステータス上昇値を通常と統一（HP/MP: +10, その他: +1）

- **音響システム統一**
  - 攻撃時・スキル使用時のSE問題を解決
  - `audio.csv`のID命名規則統一（BGM: `bgm_`, SE: `se_`プレフィックス）
  - `skills.csv`の音声参照を新しいIDに更新
  - 重複エントリ削除と整理

### 📝 データ整理
- **CSVファイル統合・整理**
  - `equipment.csv` + `equipment_gacha.csv` → `equipment_unified.csv`
  - `audio.csv`の命名規則統一
  - 素材ファイル名の保護（勝手な変更を防止）

### 🔧 技術改善
- **戦闘システム強化**
  - `autoPlayerAction()`, `processEnemyTurn()`, `toggleAutoMode()`関数追加
  - `pausedForLevelUp`フラグによる戦闘一時停止機能
  - エフェクトと音響の統合管理

- **UI/UX改善**
  - オートモード設定モーダル（style.css + index.html）
  - ボタンの視覚的フィードバック改善
  - レベルアップフロー最適化

### 📊 現在の状態
- ✅ オートモード完全動作
- ✅ SE・エフェクト統合システム
- ✅ レベルアップ自動/手動選択
- ✅ 戦闘フロー自動化
- ✅ アイテム・装備システム統合完了

## Version 0.9.1 - アイテム・装備システム完全統合 (2025-01-26)

### 🛠️ バグ修正
- **アイテムシステム統合**
  - `shop.csv` + `items.csv` → `items_unified.csv`に統合
  - `equipment_unified.csv`のフィールド名統一（`item_id` → `id`, `item_name` → `name`, `price` → `buy_price`）
  - ショップでの装備品表示問題を解決

- **装備システム修正**
  - JavaScript側の`item_id`参照を`id`に統一
  - `equipment_type`フィールドによる装備判定を追加
  - `startsWith`エラーの修正（`itemInfo.effect_type?.startsWith()`）
  - 装備品の処理フローを完全統合

### 🔧 技術改善
- **データ整合性向上**
  - CSVフィールド名の完全統一
  - データアクセス関数の一元化（`getAvailableShopItems()`, `getShopItem()`）
  - ID不一致によるundefinedエラーを完全排除

### 📊 現在の状態
- ✅ オートモード完全動作
- ✅ SE・エフェクト統合システム
- ✅ レベルアップ自動/手動選択
- ✅ 戦闘フロー自動化
- ✅ アイテム・装備システム完全統合

---

## Version 0.8.0 - キャラクター管理システム完全実装 (2025-08-26)

### 🎮 新機能
- **キャラクター個別データ管理システム**
  - 各キャラクターが個別のレベル、経験値、装備を保持
  - ゴールドとインベントリは全キャラクター共通で管理
  - CharacterManagerヘルパー関数による統一的なデータ管理

- **酒場キャラクター購入システム**
  - CSV管理による購入可能キャラクターの設定
  - 購入価格とキャラクター能力値の表示
  - 購入後の自動初期化処理

### 🔧 システム改善
- **ゲームステート構造の大幅リファクタリング**
  - `gameState.characterData`: 各キャラクター個別データ
  - `gameState.shared`: 共通データ（ゴールド・インベントリ）
  - 全ての参照を新しい構造に統一

- **オーディオ管理システム**
  - `data/audio.csv`による音声ファイル管理
  - AudioManagerクラスによる効率的な音声制御
  - 敵攻撃音・魔法音・各種SEの充実

- **スキルアニメーションシステム**
  - skills.csvベースのアニメーション管理
  - 複数アニメーションタイプ対応（fire_burst, heal_light等）
  - 音声と連携したエフェクト表示

### 🎨 UI改善
- **統一ボタンデザイン**
  - ギルド・宿屋・酒場・アイテムショップ・ガチャ・オプション
  - ツールチップ形式の説明表示
  - 戦闘ログとの重複回避レイアウト

- **酒場システム**
  - 購入可能/所有済みキャラクター表示
  - キャラクター能力値とポートレート表示
  - ワンクリック購入＆切り替え機能

### 🐛 バグ修正
- **敵攻撃アニメーション修正**
  - executeEnemySkill内でのアニメーション呼び出し追加
  - 敵の拡大・縮小エフェクト復活
  - 画面揺れと効果音の同期

- **キャラクター切り替え時の問題修正**
  - 各キャラクターの進行状況が正しく保存/復元される
  - 装備品の個別管理
  - 衣服状態の正しい初期化

### 📁 ファイル構造
- `data/audio.csv`: 音声ファイル管理（新規）
- `data/skills.csv`: アニメーション情報追加
- `data/characters.csv`: 購入価格とポートレート情報追加
- `script.js`: CharacterManager追加、ゲームステート構造変更
- `style.css`: 統一ボタンスタイル、アニメーション追加
- `index.html`: 酒場モーダル、統一UI追加

---

## Previous Versions

### Version 0.7.0 - HPベース立ち絵システム＋衣服修理機能完全実装
- HPに基づく立ち絵表示システム
- 衣服ダメージ＆修理システム
- 宿屋での衣服修理機能

### Version 0.6.0 - 戦闘エフェクト完全修正：黒い四角削除＋攻撃アニメーション実装
- 戦闘アニメーション不具合修正
- 攻撃エフェクトの視覚的改善

### Version 0.5.0 - UI改善：敵情報オーバーレイ＋プレイヤーコントロール黒化
- 敵情報表示システム改善
- UIコントロールの視認性向上

### Version 0.4.0 - UI大幅改善：フィールド/ダンジョンシステム＋宿屋＋ガチャ実装
- フィールド・ダンジョン探索システム
- 宿屋システム実装
- ガチャシステム基盤構築

### Version 0.3.0 - 装備システム完全実装＋章別アイテム解禁システム＋UI大幅改善
- 装備システム基盤実装
- 章進行システム
- UI全体の統一性向上