<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>堕ちた英雄</title>
    <link rel="stylesheet" href="style.css?v=20250824">
</head>
<body>
    <div class="game-container">
        <!-- 新しいゲーム画面レイアウト -->
        <div class="game-main">
            <!-- 左エリア：主人公立ち絵 -->
            <div class="player-portrait-area">
                <img id="playerImage" src="./assets/images/characters/player_portrait.png" alt="主人公" class="player-portrait" 
                     onerror="this.style.backgroundColor='#4299e1'; this.innerHTML='<div class=\'placeholder-text\'>主人公<br>立ち絵</div>'">
                
                <!-- プレイヤーステータス（立ち絵下に移動） -->
                <div class="player-stats-left">
                    <div class="stat-title">プレイヤーステータス</div>
                    <div class="detailed-stats-left">
                        <div class="stat-item-left">攻撃: <span id="playerAttack">20</span></div>
                        <div class="stat-item-left">防御: <span id="playerDefense">10</span></div>
                        <div class="stat-item-left">魔力: <span id="playerMagic">15</span></div>
                        <div class="stat-item-left">素早: <span id="playerSpeed">12</span></div>
                    </div>
                    
                    <!-- 装備表示 -->
                    <div class="player-equipment">
                        <div class="equipment-title">装備</div>
                        <div class="equipment-grid">
                            <div class="equipment-slot">
                                <div class="equipment-label">武器</div>
                                <div class="equipment-name" id="equippedWeapon">なし</div>
                            </div>
                            <div class="equipment-slot">
                                <div class="equipment-label">盾</div>
                                <div class="equipment-name" id="equippedShield">なし</div>
                            </div>
                            <div class="equipment-slot">
                                <div class="equipment-label">頭</div>
                                <div class="equipment-name" id="equippedHead">なし</div>
                            </div>
                            <div class="equipment-slot">
                                <div class="equipment-label">胴</div>
                                <div class="equipment-name" id="equippedBody">なし</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 経験値と所持金 -->
                    <div class="player-resources">
                        <div class="resource-item">
                            <span class="resource-label">経験値:</span>
                            <span class="resource-value" id="playerExp">0</span>
                            <span class="resource-next">/ <span id="nextLevelExp">20</span></span>
                        </div>
                        <div class="resource-item">
                            <span class="resource-label">所持金:</span>
                            <span class="resource-value" id="playerGold">100</span>
                            <span class="resource-unit">G</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 中央エリア：敵キャラクター -->
            <div class="enemy-area">
                <div class="stage-background">
                    <img id="stageBackground" src="./assets/images/backgrounds/plains_bg.jpg" alt="ステージ背景" class="background-image"
                         onerror="this.style.backgroundColor='#87CEEB'; this.innerHTML='<div class=\'placeholder-text\'>背景</div>'">
                </div>
                <div class="enemy-container">
                    <img id="enemyImage" src="./assets/images/enemies/slime.png" alt="敵キャラ" class="enemy-image" 
                         onerror="this.style.backgroundColor='#FF6BF5'; this.innerHTML='<div class=\'placeholder-text\'>敵</div>'">
                    <div class="enemy-info">
                        <div class="enemy-name" id="enemyName">スライム</div>
                        <div class="enemy-hp-bar">
                            <div class="hp-bar-bg">
                                <div class="hp-bar-fill" id="enemyHpBar" style="width: 100%"></div>
                            </div>
                            <div class="hp-text" id="enemyHpText">50/50</div>
                        </div>
                    </div>
                    
                    <!-- プレイヤーHP/MPゲージ（敵HPの下に移動） -->
                    <div class="player-bars-center">
                        <div class="player-bar-row">
                            <span class="bar-label">プレイヤーHP</span>
                            <div class="hp-bar-bg">
                                <div class="hp-bar-fill player-hp" id="playerHpBar" style="width: 100%"></div>
                            </div>
                            <span class="bar-value" id="playerHpText">100/100</span>
                        </div>
                        <div class="player-bar-row">
                            <span class="bar-label">プレイヤーMP</span>
                            <div class="mp-bar-bg">
                                <div class="mp-bar-fill" id="playerMpBar" style="width: 100%"></div>
                            </div>
                            <span class="bar-value" id="playerMpText">30/30</span>
                        </div>
                        
                        <!-- コマンドエリア（HP/MP下に移動） -->
                        <div class="command-section-center">
                            <div class="command-buttons-center">
                                <button class="command-btn attack-btn" id="attackBtn">攻撃</button>
                                <button class="command-btn skill-btn" id="skillBtn">スキル</button>
                                <button class="command-btn item-btn" id="itemBtn">アイテム</button>
                                <button class="command-btn auto-btn" id="autoBtn">オート</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右エリア：章情報＋ショップ -->
            <div class="right-panel">
                <!-- 章情報（右に移動） -->
                <div class="chapter-info-right">
                    <div class="level-info">Lv: <span id="playerLevel">1</span></div>
                    <div class="battle-info">
                        <span id="chapterDisplay">1章</span> - 戦闘 <span id="battleCount">1</span>/<span id="maxBattles">10</span>
                    </div>
                </div>
                
                <!-- フィールド/ダンジョン選択 -->
                <div class="location-selection">
                    <div class="location-label">探索場所</div>
                    <div class="location-buttons">
                        <button class="location-btn active" id="fieldBtn">フィールド</button>
                        <button class="location-btn" id="dungeonBtn">ダンジョン</button>
                    </div>
                    <div class="location-info" id="locationInfo">フィールドで安全に戦闘</div>
                </div>

                <!-- ショップエリア -->
                <div class="shop-section">
                    <div class="shop-label">ショップ</div>
                    <button class="shop-btn" id="shopBtn">
                        <span class="btn-text">🏪 ショップに入る</span>
                    </button>
                    <p class="shop-note">※ショップ利用後は<br>敵が1体目に戻ります</p>
                </div>

                <!-- 宿屋エリア -->
                <div class="inn-section">
                    <div class="inn-label">宿屋</div>
                    <button class="inn-btn" id="innBtn">
                        <span class="btn-text">🏨 宿屋に泊まる</span>
                    </button>
                    <p class="inn-price">100ゴールドでHP/MP全回復</p>
                    <p class="inn-note">※フィールドからのみ利用可能</p>
                </div>

                <!-- ガチャショップエリア -->
                <div class="gacha-section">
                    <div class="gacha-label">ガチャショップ</div>
                    <button class="gacha-btn equipment-gacha-btn" id="equipmentGachaBtn">
                        <span class="btn-text">⚔️ 装備ガチャ</span>
                    </button>
                    <p class="gacha-price">500ゴールド</p>
                    <button class="gacha-btn illustration-gacha-btn" id="illustrationGachaBtn">
                        <span class="btn-text">🖼️ イラストガチャ</span>
                    </button>
                    <p class="gacha-price">100ゴールド</p>
                </div>
            </div>
        </div>

        <!-- 下部：戦闘ログ -->
        <div class="battle-log">
            <div class="log-header">戦闘ログ</div>
            <div class="log-content" id="battleLogContent">
                <div class="log-entry">戦闘が開始されました</div>
            </div>
        </div>

        <!-- スキル選択モーダル -->
        <div class="modal" id="skillModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>スキル選択</h3>
                    <button class="close-btn" id="closeSkillModal">&times;</button>
                </div>
                <div class="skill-list">
                    <button class="skill-option" data-skill="fireball">
                        <div class="skill-name">ファイアボール</div>
                        <div class="skill-cost">MP: 10</div>
                        <div class="skill-desc">炎属性の魔法攻撃</div>
                    </button>
                    <button class="skill-option" data-skill="heal">
                        <div class="skill-name">ヒール</div>
                        <div class="skill-cost">MP: 8</div>
                        <div class="skill-desc">HPを回復する</div>
                    </button>
                </div>
            </div>
        </div>

        <!-- アイテム選択モーダル -->
        <div class="modal" id="itemModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>アイテム使用</h3>
                    <button class="close-btn" id="closeItemModal">&times;</button>
                </div>
                <div class="item-list" id="itemList">
                    <!-- アイテムが動的に生成される -->
                </div>
            </div>
        </div>

        <!-- ショップモーダル -->
        <div class="modal" id="shopModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🏪 ショップ</h3>
                    <button class="close-btn" id="closeShopModal">&times;</button>
                </div>
                <div class="shop-info">
                    <div class="player-gold">所持金: <span id="shopPlayerGold">100</span>G</div>
                </div>
                <div class="shop-items" id="shopItemsList">
                    <!-- ショップアイテムが動的に生成される -->
                </div>
            </div>
        </div>

        <!-- レベルアップモーダル -->
        <div class="modal" id="levelUpModal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🎉 レベルアップ！</h3>
                </div>
                <div class="level-up-info">
                    <div class="level-display">Level <span id="levelUpDisplay">2</span>になりました！</div>
                    <div class="stat-points">ステータスポイント: <span id="availablePoints">3</span></div>
                </div>
                <div class="stat-allocation">
                    <div class="stat-group">
                        <div class="stat-row">
                            <span class="stat-label">HP</span>
                            <button class="stat-btn minus" data-stat="maxHp" data-type="minus">-</button>
                            <span class="stat-current" id="statHp">100</span>
                            <button class="stat-btn plus" data-stat="maxHp" data-type="plus">+</button>
                            <span class="stat-effect">(+10)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">MP</span>
                            <button class="stat-btn minus" data-stat="maxMp" data-type="minus">-</button>
                            <span class="stat-current" id="statMp">30</span>
                            <button class="stat-btn plus" data-stat="maxMp" data-type="plus">+</button>
                            <span class="stat-effect">(+10)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">攻撃</span>
                            <button class="stat-btn minus" data-stat="attack" data-type="minus">-</button>
                            <span class="stat-current" id="statAttack">20</span>
                            <button class="stat-btn plus" data-stat="attack" data-type="plus">+</button>
                            <span class="stat-effect">(+1)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">防御</span>
                            <button class="stat-btn minus" data-stat="defense" data-type="minus">-</button>
                            <span class="stat-current" id="statDefense">10</span>
                            <button class="stat-btn plus" data-stat="defense" data-type="plus">+</button>
                            <span class="stat-effect">(+1)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">魔力</span>
                            <button class="stat-btn minus" data-stat="magic" data-type="minus">-</button>
                            <span class="stat-current" id="statMagic">15</span>
                            <button class="stat-btn plus" data-stat="magic" data-type="plus">+</button>
                            <span class="stat-effect">(+1)</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-label">素早</span>
                            <button class="stat-btn minus" data-stat="speed" data-type="minus">-</button>
                            <span class="stat-current" id="statSpeed">12</span>
                            <button class="stat-btn plus" data-stat="speed" data-type="plus">+</button>
                            <span class="stat-effect">(+1)</span>
                        </div>
                    </div>
                </div>
                <div class="level-up-actions">
                    <button class="confirm-btn" id="confirmLevelUp">決定</button>
                </div>
            </div>
        </div>
    </div>

    <script src="data_manager.js"></script>
    <script src="script.js"></script>
</body>
</html>